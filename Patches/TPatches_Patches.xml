<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!--
    <Operation Class="XmlExtensions.OptionalPatch">
    <modId>carnap2.TPatches</modId>
    <key>TPatches???</key>
    <defaultValue>???</defaultValue>
    <caseTrue>
    <Operation Class="???">
    
    </Operation>
    </caseTrue>
    <caseFalse>
    
    </caseFalse>
    </Operation>
    
    -->
    <!-- fix factions not showing in create world menu -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesFixSomeModdedFactionsNotShowingUpInCreateWorldMenu</key>
        <defaultValue>true</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationAdd">
                <success>Always</success>
                <xpath>/Defs/FactionDef[(defName and not(maxConfigurableAtWorldCreation) and not(hidden="true") and not(isPlayer="true") and(@ParentName="FactionBase" or not(@ParentName))) or (defName="SavageGiants") and not(maxConfigurableAtWorldCreation)]</xpath>
                <value>
                    <maxConfigurableAtWorldCreation>9999</maxConfigurableAtWorldCreation>
                </value>
            </Operation>
        </caseTrue>
        <caseFalse>
            <!--Patch operations here - not needed-->
        </caseFalse>
    </Operation>
    
    
    
    <!-- HAR research restriction removers -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesHARResearchRestrictionRemover</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationRemove">
                <success>Always</success>
                <xpath>/Defs/AlienRace.ThingDef_AlienRace/alienRace/raceRestriction/researchList</xpath>
            </Operation>
        </caseTrue>
        <caseFalse>
            <!--Patch operations here-->
        </caseFalse>
    </Operation>
    
    <!-- HAR thoughtsettings removers -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesHARthoughtSettingsRemover</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationRemove">
                <success>Always</success>
                <xpath>/Defs/AlienRace.ThingDef_AlienRace/alienRace/thoughtSettings</xpath>
            </Operation>
        </caseTrue>
        <caseFalse>
            <!--Patch operations here-->
        </caseFalse>
    </Operation>
    
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesNerubiansFix</key>
        <defaultValue>true</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationRemove">
                <success>Always</success>
                <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Nerubian"]/alienRace/raceRestriction/weaponList</xpath>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
    <!-- VAE Accessories - Ranged Shield Belt nerf -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesVAEARangedShieldBelt</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationReplace">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="VAEA_Apparel_RangedShieldBelt"]/statBases/EnergyShieldRechargeRate</xpath>
                <value>
                    <EnergyShieldRechargeRate>0.05</EnergyShieldRechargeRate> <!-- default 0.13 -->
                </value>
            </Operation>
            <Operation Class="PatchOperationReplace">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="VAEA_Apparel_RangedShieldBelt"]/statBases/EnergyShieldEnergyMax</xpath>
                <value>
                    <EnergyShieldEnergyMax>0.3</EnergyShieldEnergyMax> <!-- default 0.9 -->
                </value>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
    <!-- VAE Accessories - Mini-turret pack nerf -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesVAEAMiniTurretPack</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationAdd">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="VAEA_Apparel_MiniTurretPack"]/recipeMaker[not (researchPrerequisite="GunTurrets")]</xpath>
                <value>
                    <researchPrerequisite>GunTurrets</researchPrerequisite>
                </value>
            </Operation>
            <Operation Class="PatchOperationReplace">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="VAEA_Apparel_MiniTurretPack"]/verbs/li/defaultProjectile</xpath>
                <value>
                    <defaultProjectile>TPatches_Bullet_MiniTurretPack</defaultProjectile>
                </value>
            </Operation>
            <Operation Class="PatchOperationReplace">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="VAEA_Apparel_MiniTurretPack"]/verbs/li/range</xpath>
                <value>
                    <range>22.9</range> <!-- default 28.9 -->
                </value>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
    <!-- fantasy metals rebalance -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesFantasyMetals</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationSequence">
                <success>Always</success>
                <operations>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Mithril"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.03</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Mithril"]/deepLumpSizeRange</xpath>
                        <value>
                            <deepLumpSizeRange>
                                <min>1</min>
                                <max>5</max>
                            </deepLumpSizeRange>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Orichalcum"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.03</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Orichalcum"]/deepCountPerPortion</xpath>
                        <value>
                            <deepCountPerPortion>5</deepCountPerPortion>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Orichalcum"]/deepLumpSizeRange</xpath>
                        <value>
                            <deepLumpSizeRange>
                                <min>1</min>
                                <max>5</max>
                            </deepLumpSizeRange>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Adamantite"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.03</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Adamantite"]/deepLumpSizeRange</xpath>
                        <value>
                            <deepLumpSizeRange>
                                <min>1</min>
                                <max>4</max>
                            </deepLumpSizeRange>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Tozra"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.03</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Tozra"]/deepCountPerPortion</xpath>
                        <value>
                            <deepCountPerPortion>5</deepCountPerPortion>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Tozra"]/deepLumpSizeRange</xpath>
                        <value>
                            <deepLumpSizeRange>
                                <min>1</min>
                                <max>5</max>
                            </deepLumpSizeRange>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Solorite"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.05</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Solorite"]/deepCountPerPortion</xpath>
                        <value>
                            <deepCountPerPortion>5</deepCountPerPortion>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Skelsshkrum"]/deepCommonality</xpath>
                        <value>
                            <deepCommonality>0.03</deepCommonality>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Skelsshkrum"]/deepCountPerPortion</xpath>
                        <value>
                            <deepCountPerPortion>5</deepCountPerPortion>
                        </value>
                    </li>
                    <li Class="PatchOperationReplace">
                        <success>Normal</success>
                        <xpath>/Defs/ThingDef[defName="Skelsshkrum"]/deepLumpSizeRange</xpath>
                        <value>
                            <deepLumpSizeRange>
                                <min>1</min>
                                <max>5</max>
                            </deepLumpSizeRange>
                        </value>
                    </li>
                </operations>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
    <!-- replace "golden?" with solpyrite -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesFantasyMetalSolpyrite</key>
        <defaultValue>false</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationRemove">
                <success>Always</success>
                <xpath>/Defs/ThingDef[defName="Solorite"]/stuffProps/stuffAdjective</xpath>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
    
    <!-- Rottable filter -->
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>TPatchesFilterRottable</key>
        <defaultValue>true</defaultValue>
        <caseTrue>
            <Operation Class="PatchOperationAdd">
                <xpath>/Defs</xpath>
                <value>
                    <ThingCategoryDef>
                        <defName>TPatchesRottable</defName>
                        <label>*Rottable</label>
                        <parent>Root</parent>
                    </ThingCategoryDef>
                </value>
            </Operation>
            <Operation Class="PatchOperationAdd">
                <success>Always</success>
                <xpath>/Defs/ThingDef[comps/li/daysToRotStart]/thingCategories</xpath>
                <value>
                    <li>TPatchesRottable</li>
                </value>
            </Operation>
            <Operation Class="PatchOperationAdd">
                <success>Always</success>
                <xpath>/Defs/ThingDef[(comps/li/daysToRotStart) and (not(thingCategories))]</xpath>
                <value>
                    <thingCategories>
                        <li>TPatchesRottable</li>
                    </thingCategories>
                </value>
            </Operation>
        </caseTrue>
        <caseFalse>
            
        </caseFalse>
    </Operation>
    
</Patch>
