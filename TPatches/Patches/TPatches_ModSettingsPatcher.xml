<?xml version="1.0" encoding="utf-8"?>
<Patch>
    
    <!-- detecting if there are factions that don't show up in create world menu - case where there are -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>/Defs/FactionDef[(defName and not(maxConfigurableAtWorldCreation) and not(hidden="true") and not(isPlayer="true") and(@ParentName="FactionBase" or not(@ParentName))) or ((defName="SavageGiants") and not(maxConfigurableAtWorldCreation))]</xpath>
                <success>Normal</success>
            </li>
            <li Class="PatchOperationReplace">
                <xpath>/Defs/XmlExtensions.SettingsMenuDef/settings/li/tabs/li/settings/carnap2TPatches1</xpath>
                <value>
                    <li Class="XmlExtensions.Setting.Section">
                        <settings>
                            <li Class="XmlExtensions.Setting.Checkbox">
                                <key>TPatchesFixSomeModdedFactionsNotShowingUpInCreateWorldMenu</key>
                                <label>Fix some modded factions not showing up in create world menu</label>
                                <tooltip>this xpath adds maxConfigurableAtWorldCreation=9999 to all non-hidden non-player non-abstract factions that aren't based on anything other than factionBase and don't already have this line.</tooltip>
                            </li>
                            <li Class="XmlExtensions.Setting.Text">
                                <font>Tiny</font>
                                <text>Some modded factions have a bug where they don't appear in create world menu, this setting fixes that</text>
                            </li>
                            <li Class="XmlExtensions.Setting.SetColor">
                                <color>(155,255,255)</color>
                            </li>
                            <li Class="XmlExtensions.Setting.Text">
                                <font>Tiny</font>
                                <text>info: some factions that have this bug are detected in your game. This setting will fix them.</text>
                            </li>
                            <li Class="XmlExtensions.Setting.SetColor">
                                <color>(255,255,255)</color>
                            </li>
                        </settings>
                    </li>
                </value>
            </li>
        </operations>
    </Operation>    
    <!-- detecting if there are factions that don't show up in create world menu - case where there aren't -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>/Defs/FactionDef[(defName and not(maxConfigurableAtWorldCreation) and not(hidden="true") and not(isPlayer="true") and(@ParentName="FactionBase" or not(@ParentName))) or ((defName="SavageGiants") and not(maxConfigurableAtWorldCreation))]</xpath>
                <success>Invert</success>
            </li>
            <li Class="PatchOperationReplace">
                <xpath>/Defs/XmlExtensions.SettingsMenuDef/settings/li/tabs/li/settings/carnap2TPatches1</xpath>
                <value>
                    <li Class="XmlExtensions.Setting.Section">
                        <settings>
                            <li Class="XmlExtensions.Setting.SetColor">
                                <color>(255,255,255)</color>
                            </li>
                            <li Class="XmlExtensions.Setting.Checkbox">
                                <key>TPatchesFixSomeModdedFactionsNotShowingUpInCreateWorldMenu</key>
                                <label>Fix some modded factions not showing up in create world menu</label>
                                <tooltip>this xpath adds maxConfigurableAtWorldCreation=9999 to all non-hidden non-player non-abstract factions that aren't based on anything other than factionBase and don't already have this line.</tooltip>
                            </li>
                            <li Class="XmlExtensions.Setting.Text">
                                <font>Tiny</font>
                                <text>Some modded factions have a bug where they don't appear in create world menu, this setting fixes that</text>
                            </li>
                            <li Class="XmlExtensions.Setting.SetColor">
                                <color>(155,255,255)</color>
                            </li>
                            <li Class="XmlExtensions.Setting.Text">
                                <font>Tiny</font>
                                <text>info: no factions with this bug were detected in your game.</text>
                            </li>
                            <li Class="XmlExtensions.Setting.SetColor">
                                <color>(255,255,255)</color>
                            </li>
                        </settings>
                    </li>
                </value>
            </li>
        </operations>
    </Operation>
    
    
    
    
    <!-- detecting whether HAR is loaded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Humanoid Alien Races</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationReplace">
                    <xpath>/Defs/XmlExtensions.SettingsMenuDef/settings/li/tabs/li/settings/carnap2TPatches2</xpath>
                    <value>
                        <li Class="XmlExtensions.Setting.Section">
                            <settings>
                                <li Class="XmlExtensions.Setting.Checkbox">
                                    <key>TPatchesHARResearchRestrictionRemover</key>
                                    <label>Remove all research restrictions from HAR races</label>
                                    <tooltip>this xpath removes all researchList nodes.</tooltip>
                                </li>
                                <li Class="XmlExtensions.Setting.Text">
                                    <font>Tiny</font>
                                    <text>This will allow all races to research all research projects. Useful if you use mods like Random Research, since it might choose a project restricted to some race you don't have and you will be stuck.</text>
                                </li>
                                <li Class="XmlExtensions.Setting.GapLine"/>
                                <li Class="XmlExtensions.Setting.Checkbox">
                                    <key>TPatchesHARthoughtSettingsRemover</key>
                                    <label>Remove all custom thoughts from HAR races</label>
                                    <tooltip>this xpath removes all thoughtSettings nodes.</tooltip>
                                </li>
                                <li Class="XmlExtensions.Setting.Text">
                                    <font>Tiny</font>
                                    <text>Removes all custom thoughts, making them identical to vanilla human thoughts. Might make the game more balanced by reintroducing mood debuffs to races that had them disabled, and also might slightly improve performance.</text>
                                </li>
                            </settings>
                        </li>
                    </value>
                </li>
            </operations>
        </match>
        <nomatch Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationReplace">
                    <xpath>/Defs/XmlExtensions.SettingsMenuDef/settings/li/tabs/li/settings/carnap2TPatches2</xpath>
                    <value>
                        <li Class="XmlExtensions.Setting.Section">
                            <settings>
                                <li Class="XmlExtensions.Setting.Text">
                                    <text>You don't have Humanoid Alien Races enabled. Those settings will have no effect! You can still have them enabled in case you want to install HAR in the future.</text>
                                </li>
                                <li Class="XmlExtensions.Setting.SetColor">
                                    <color>(155,155,155)</color>
                                </li>
                                <li Class="XmlExtensions.Setting.Checkbox">
                                    <key>TPatchesHARResearchRestrictionRemover</key>
                                    <label>Remove research restrictions from HAR races</label>
                                    <tooltip>this xpath removes all researchList nodes.</tooltip>
                                </li>
                                <li Class="XmlExtensions.Setting.Text">
                                    <font>Tiny</font>
                                    <text>This will allow all races to research all research projects. Useful if you use mods like Random Research, since it might choose a project restricted to some race you don't have and you will be stuck.</text>
                                </li>
                                <li Class="XmlExtensions.Setting.Checkbox">
                                    <key>TPatchesHARthoughtSettingsRemover</key>
                                    <label>Remove all custom thoughts from HAR races</label>
                                    <tooltip>this xpath removes all thoughtSettings nodes.</tooltip>
                                </li>
                                <li Class="XmlExtensions.Setting.Text">
                                    <font>Tiny</font>
                                    <text>Removes all custom thoughts, making them identical to vanilla human thoughts. Might make the game more balanced by reintroducing mood debuffs to races that had them disabled, and also might slightly improve performance.</text>
                                </li>
                            </settings>
                        </li>
                        <li Class="XmlExtensions.Setting.SetColor">
                            <color>(155,155,155)</color>
                        </li>
                    </value>
                </li>
            </operations>
        </nomatch>
    </Operation>
</Patch>
